import{a as l,b as d,y as o,j as r,H as C,r as m}from"./app-kKseVrtb.js";function b(p){if(!p)return null;const g=new Date,e=new Date(p)-g;if(e<=0)return"Expirado";const s=Math.floor(e/6e4),x=Math.floor(e%6e4/1e3);return`${s}:${x.toString().padStart(2,"0")}`}function k({cart:p,total:g,total_items:v}){const[e,s]=l.useState(p),[x,c]=l.useState({}),[u,h]=l.useState(null);l.useEffect(()=>{n()},[]),l.useEffect(()=>{if(e?.expires_at){const t=b(e.expires_at);if(t==="Expirado"){f();return}const a=setInterval(()=>{const i=b(e.expires_at);h(i),i==="Expirado"&&(clearInterval(a),f())},1e3);return h(t),()=>clearInterval(a)}else h(null)},[e?.expires_at]);const f=async()=>{try{await d.delete("/api/v1/cart/clear"),o.warning("El carrito ha expirado y ha sido vaciado"),await n()}catch(t){console.error("Error al limpiar carrito expirado:",t),await n()}},n=async()=>{try{const t=await d.get("/api/v1/cart");if(console.log("Cart API response:",t.data),console.log("Cart data:",t.data?.data?.cart),console.log("Items:",t.data?.data?.cart?.items),t.data.success&&t.data.data&&t.data.data.cart){const a=t.data.data.cart;a.items||(a.items=[]),console.log("Setting cart with items:",a.items.length),s(a);const i={};Array.isArray(a.items)&&a.items.length>0&&a.items.forEach(j=>{i[j.id]=j.quantity}),c(i)}else console.log("No cart data found, setting to null"),s(null),c({})}catch(t){console.error("Error loading cart:",t),console.error("Error response:",t.response),s(null),c({})}},E=async(t,a)=>{if(!(a<1))try{await d.put(`/api/v1/cart/items/${t}`,{quantity:parseInt(a)}),c(i=>({...i,[t]:parseInt(a)})),n(),o.success("Cantidad actualizada")}catch{o.error("Error al actualizar cantidad")}},w=async t=>{if(window.confirm("¿Eliminar este producto del carrito?"))try{await d.delete(`/api/v1/cart/items/${t}`),n(),o.success("Producto eliminado del carrito")}catch{o.error("Error al eliminar producto")}},I=async()=>{if(window.confirm("¿Vaciar todo el carrito?"))try{await d.delete("/api/v1/cart/clear"),n(),o.success("Carrito vaciado")}catch{o.error("Error al vaciar carrito")}},y=!e||!e.items||!Array.isArray(e.items)||e.items.length===0;return console.log("Cart state:",{cart:e,hasCart:!!e,hasItems:!!e?.items,itemsIsArray:Array.isArray(e?.items),itemsLength:e?.items?.length,isEmpty:y}),y?r.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[r.jsx(C,{title:"Carrito"}),r.jsx("h1",{children:"Carrito - Testing"}),r.jsx("p",{children:"El carrito está vacío"}),r.jsx("button",{onClick:()=>m.visit(route("menu.index")),style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",cursor:"pointer",marginTop:"10px"},children:"Ir al Menú"})]}):r.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[r.jsx(C,{title:"Carrito"}),r.jsx("h1",{children:"Carrito - Testing"}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("button",{onClick:()=>m.visit(route("menu.index")),style:{padding:"10px 20px",backgroundColor:"#6c757d",color:"white",border:"none",cursor:"pointer",marginRight:"10px"},children:"Continuar Comprando"}),r.jsx("button",{onClick:I,style:{padding:"10px 20px",backgroundColor:"#dc3545",color:"white",border:"none",cursor:"pointer"},children:"Vaciar Carrito"})]}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("h2",{children:"Items del Carrito"}),e.items.map(t=>r.jsxs("div",{style:{border:"1px solid #ddd",padding:"15px",marginBottom:"10px",borderRadius:"5px"},children:[r.jsx("h3",{children:t.product?.name||"Producto"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Precio unitario:"})," $",t.price]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Subtotal:"})," $",(t.quantity*t.price).toFixed(2)]}),t.special_instructions&&r.jsxs("p",{children:[r.jsx("strong",{children:"Instrucciones:"})," ",t.special_instructions]}),r.jsxs("div",{style:{marginTop:"10px",display:"flex",gap:"10px",alignItems:"center"},children:[r.jsxs("label",{children:["Cantidad:",r.jsx("input",{type:"number",min:"1",max:t.product?.stock||999,value:x[t.id]||t.quantity,onChange:a=>c(i=>({...i,[t.id]:parseInt(a.target.value)||1})),onBlur:a=>E(t.id,a.target.value),style:{marginLeft:"5px",padding:"5px",width:"60px"}})]}),r.jsx("button",{onClick:()=>w(t.id),style:{padding:"8px 15px",backgroundColor:"#dc3545",color:"white",border:"none",cursor:"pointer"},children:"Eliminar"})]})]},t.id))]}),r.jsxs("div",{style:{border:"2px solid #007bff",padding:"20px",borderRadius:"5px",marginTop:"20px"},children:[r.jsx("h2",{children:"Resumen"}),u&&r.jsxs("p",{style:{color:u==="Expirado"?"#dc3545":"#ffc107",fontWeight:"bold",marginBottom:"10px"},children:[r.jsx("strong",{children:"Tiempo restante:"})," ",u]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Total de items:"})," ",e.total_items||0]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Subtotal:"})," $",(e.total||0).toFixed(2)]}),r.jsxs("p",{children:[r.jsx("strong",{children:"IVA (16%):"})," $",((e.total||0)*.16).toFixed(2)]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Total:"})," $",((e.total||0)*1.16).toFixed(2)]}),r.jsx("button",{onClick:()=>m.visit(route("checkout.index")),style:{marginTop:"15px",padding:"12px 30px",backgroundColor:"#28a745",color:"white",border:"none",cursor:"pointer",fontSize:"16px"},children:"Proceder al Checkout"})]})]})}export{k as default};
